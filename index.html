<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TicketUI – Ring Zoom + OK Apply</title>
<script src="https://cdn.tailwindcss.com"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui;
    overflow: hidden;
  }

  /* Mobile-safe real color input */
  .color-input {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }
</style>
</head>

<body class="w-full h-screen bg-[#1797D0] overflow-hidden">

<!-- CENTER STAGE -->
<div class="w-full h-full flex items-center justify-center relative overflow-hidden">

  <!-- ✅ TICKET GROUP: background + all elements share SAME coordinate system -->
  <div id="ticketGroup"
       class="relative w-[375px] h-[812px] origin-center"
       style="transform: scale(1);">

    <!-- BACKGROUND INSIDE PHONE FRAME (so it aligns perfectly) -->
    <div id="bgImageContainer"
         class="absolute inset-0"
         style="
           background-size: cover;
           background-position: center;
           background-repeat: no-repeat;
         ">
    </div>

    <!-- QR RING -->
    <div id="qrRing"
      class="absolute"
      style="
        top:82px;
        left:50%;
        transform:translateX(-50%);
        width:169px;
        height:169px;
        border-radius:16px;
        border:13px solid;
        position:relative;
      ">
      <input type="color" class="color-input"
        onchange="setRingColor(this.value)" />
    </div>

    <!-- ✅ OK + RING ZOOM (only affects ring until OK pressed) -->
    <div class="absolute"
      style="
        top:610px;
        left:50%;
        transform:translateX(-50%);
        width:270px;
      ">

      <button id="applyOkBtn"
        class="w-full mb-2 py-2 rounded-lg bg-black text-white text-sm font-semibold active:scale-[0.99]">
        OK (Apply zoom to whole ticket)
      </button>

      <input id="ringZoomSlider"
        type="range"
        min="70"
        max="150"
        value="100"
        class="w-full" />

      <div class="mt-1 text-center text-xs text-gray-800">
        Ring Zoom: <span id="ringZoomValue">100%</span>
      </div>
    </div>

    <!-- COLOR BARS -->
    <div class="absolute flex"
      style="
        top:674px;
        left:50%;
        transform:translateX(-50%);
        width:278px;
        height:20px;
      ">

      <div id="bar1" class="flex-1 relative">
        <input type="color" class="color-input"
          onchange="setBarColor(0, this.value)" />
      </div>

      <div id="bar2" class="flex-1 relative">
        <input type="color" class="color-input"
          onchange="setBarColor(1, this.value)" />
      </div>

      <div id="bar3" class="flex-1 relative">
        <input type="color" class="color-input"
          onchange="setBarColor(2, this.value)" />
      </div>
    </div>

    <!-- EXPIRY -->
    <h3 id="expiryText"
      class="absolute w-full text-center cursor-pointer select-none"
      style="top:727px;font-size:21px;font-weight:600;">
      Expires in 60:00
    </h3>

    <!-- MIDDLE NUMBER -->
    <h1 id="middleNumber"
      class="absolute w-full text-center cursor-pointer select-none"
      style="top:309px;font-size:56px;font-weight:800;">
      2
    </h1>

  </div>
</div>

<script>
/* =====================================================
   DEFAULTS (EDIT HERE)
===================================================== */
const DEFAULT_RING_COLOR = "#9CA3AF";
const DEFAULT_BAR_COLORS = ["#22C55E", "#EF4444", "#22C55E"];

/* =====================================================
   STATE
===================================================== */
let ringColor = DEFAULT_RING_COLOR;
let barColors = [...DEFAULT_BAR_COLORS];
let middleValue = 2;

let expiryDuration = 3600;
let timeLeft = expiryDuration;
let currentBgIndex = 1;

// Ring-only scale (before OK)
let ringScale = 1;

// Whole-ticket scale (after OK)
let ticketScale = 1;

/* =====================================================
   ELEMENTS
===================================================== */
const ticketGroup = document.getElementById("ticketGroup");
const qrRing = document.getElementById("qrRing");
const bars = [
  document.getElementById("bar1"),
  document.getElementById("bar2"),
  document.getElementById("bar3")
];
const expiryText = document.getElementById("expiryText");
const middleNumber = document.getElementById("middleNumber");
const bgImageContainer = document.getElementById("bgImageContainer");

const ringZoomSlider = document.getElementById("ringZoomSlider");
const ringZoomValue = document.getElementById("ringZoomValue");
const applyOkBtn = document.getElementById("applyOkBtn");

/* =====================================================
   BACKGROUNDS
===================================================== */
const BG1 = "https://raw.githubusercontent.com/Hastin7008/buspass1/main/assets/bg1.jpg.jpg";
const BG2 = "https://raw.githubusercontent.com/Hastin7008/buspass1/main/assets/bg2.jpg.jpg";

/* =====================================================
   APPLY COLORS
===================================================== */
function applyColors() {
  qrRing.style.borderColor = ringColor;
  bars.forEach((b, i) => b.style.background = barColors[i]);
}

/* =====================================================
   RING TRANSFORM (ring zoom only)
===================================================== */
function applyRingZoomOnly() {
  // Keep translateX(-50%) and add scale
  qrRing.style.transform = `translateX(-50%) scale(${ringScale})`;
}

/* =====================================================
   TICKET TRANSFORM (whole ticket zoom)
===================================================== */
function applyTicketZoom() {
  ticketGroup.style.transform = `scale(${ticketScale})`;
}

/* =====================================================
   COLOR HANDLERS (MOBILE SAFE)
===================================================== */
function setRingColor(color) {
  ringColor = color;
  applyColors();
}

function setBarColor(index, color) {
  barColors[index] = color;
  applyColors();
}

/* =====================================================
   BLINK – FIXED 600ms
===================================================== */
let visible = true;
setInterval(() => {
  visible = !visible;
  const o = visible ? "1" : "0";
  bars.forEach(b => b.style.opacity = o);
}, 600);

/* =====================================================
   TIME
===================================================== */
function updateTime() {
  const m = Math.floor(timeLeft / 60);
  const s = String(timeLeft % 60).padStart(2, "0");
  expiryText.textContent = `Expires in ${m}:${s}`;
}

setInterval(() => {
  if (timeLeft > 0) {
    timeLeft--;
    updateTime();
  }
}, 1000);

/* =====================================================
   INTERACTIONS
===================================================== */
middleNumber.onclick = () => {
  middleValue = (middleValue + 1) % 10;
  middleNumber.textContent = middleValue;
};

expiryText.onclick = () => {
  expiryDuration = expiryDuration === 3600 ? 1800 : 3600;
  timeLeft = expiryDuration;

  bgImageContainer.style.backgroundImage =
    currentBgIndex === 1 ? `url(${BG2})` : `url(${BG1})`;
  currentBgIndex = currentBgIndex === 1 ? 2 : 1;

  updateTime();
};

/* =====================================================
   RING ZOOM SLIDER (only ring)
===================================================== */
ringZoomSlider.oninput = e => {
  ringScale = (Number(e.target.value) / 100);
  ringZoomValue.textContent = `${e.target.value}%`;
  applyRingZoomOnly();
};

/* =====================================================
   OK BUTTON: apply ring zoom to entire ticket
===================================================== */
applyOkBtn.onclick = () => {
  // Apply current ringScale to the whole ticket
  ticketScale = ringScale;
  applyTicketZoom();

  // Reset ring-only zoom so it doesn't double-scale
  ringScale = 1;
  ringZoomSlider.value = 100;
  ringZoomValue.textContent = "100%";
  applyRingZoomOnly();
};

/* =====================================================
   INIT
===================================================== */
bgImageContainer.style.backgroundImage = `url(${BG1})`;
applyColors();
applyTicketZoom();
applyRingZoomOnly();
updateTime();
</script>

</body>
</html>
