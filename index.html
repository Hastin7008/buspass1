<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ticket Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 17 + Babel (required for in-browser JSX) -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { margin: 0; background:#000; }
  </style>
</head>

<body>
  <div id="root" class="w-full min-h-screen flex justify-center"></div>

  <!-- YOUR WHOLE APP -->
  <script type="text/babel">

    const { useState, useEffect, useRef } = React;

    // ICON FALLBACKS
    const ChevronLeft = ({ className }) => (
      <svg className={className} stroke="currentColor" fill="none" 
        viewBox="0 0 24 24" strokeWidth="2.5">
        <polyline points="15 18 9 12 15 6" />
      </svg>
    );

    const Settings = ({ className }) => (
      <svg className={className} stroke="currentColor" fill="none" 
        viewBox="0 0 24 24" strokeWidth="2">
        <circle cx="12" cy="12" r="3" />
        <path d="M19.4 15a1.65 1.65..." />
      </svg>
    );

    function TicketDemo() {

      /* -------------- ALL YOUR STATES (unchanged) -------------- */
      const [view, setView] = useState("ticket");
      const [zoneNumber, setZoneNumber] = useState(2);
      const [zoneName, setZoneName] = useState("INTERSTATE");
      const [passengerCount, setPassengerCount] = useState(1);
      const [passengerType, setPassengerType] = useState("Adult");
      const [validityMinutes, setValidityMinutes] = useState(60);
      const [zoneNumberSize, setZoneNumberSize] = useState(45);
      const [isInterstateMode, setIsInterstateMode] = useState(true);

      const [colors, setColors] = useState({
        qrBackground: "#d8b4fe",
        progressColors: ["#7c3aed", "#ec4899", "#22c55e"],
        zoneNameColor: "#FF0000",
      });

      const [timeRemaining, setTimeRemaining] = useState(3600);
      const [isActive, setIsActive] = useState(true);
      const [qrCodeImage, setQrCodeImage] = useState(null);
      const [blinkSpeed, setBlinkSpeed] = useState(500);
      const [showProgress, setShowProgress] = useState(true);

      const fileInputRef = useRef(null);
      const qrInputRef = useRef(null);

      /* -------------- TIMER -------------- */
      useEffect(() => {
        if (!isActive || timeRemaining <= 0) return;

        const interval = setInterval(() => {
          setTimeRemaining(t => Math.max(0, t - 1));
        }, 1000);

        return () => clearInterval(interval);
      }, [isActive, timeRemaining]);

      /* -------------- BLINK ANIMATION -------------- */
      useEffect(() => {
        const interval = setInterval(
          () => setShowProgress(s => !s),
          blinkSpeed
        );
        return () => clearInterval(interval);
      }, [blinkSpeed]);

      const formatTime = (sec) => {
        const m = Math.floor(sec / 60);
        const s = String(sec % 60).padStart(2, "0");
        return `${m}:${s}`;
      };

      /* -------------- IMAGE COLOR EXTRACT -------------- */
      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            const px = (x, y) => ctx.getImageData(x, y, 1, 1).data;
            const A = px(img.width*0.3, img.height*0.3);
            const B = px(img.width*0.5, img.height*0.5);
            const C = px(img.width*0.7, img.height*0.7);

            const rgb = (r,g,b)=>"#"+[r,g,b].map(x=>x.toString(16).padStart(2,"0")).join("");

            setColors(prev => ({
              ...prev,
              qrBackground: rgb(A[0],A[1],A[2]),
              progressColors:[
                rgb(A[0],A[1],A[2]),
                rgb(B[0],B[1],B[2]),
                rgb(C[0],C[1],C[2])
              ]
            }));
          };
          img.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      };

      /* -------------- QR UPLOAD -------------- */
      const handleQrUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = ev => setQrCodeImage(ev.target.result);
        reader.readAsDataURL(file);
      };

      /* -------------- MODE SWITCH -------------- */
      const toggleInterstateMode = () => {
        if (isInterstateMode) {
          setZoneName("INTRASTATE");
          setColors(c => ({...c, zoneNameColor:"#000"}))
          setValidityMinutes(30);
          setTimeRemaining(1800);
        } else {
          setZoneName("INTERSTATE");
          setColors(c => ({...c, zoneNameColor:"#FF0000"}))
          setValidityMinutes(60);
          setTimeRemaining(3600);
        }
        setIsInterstateMode(!isInterstateMode);
      };

      /* ----------------------------------------------------
         ------------------ RETURN UI ------------------------
         ---------------------------------------------------- */

      return (
        <div className="min-h-screen w-full max-w-[430px] bg-black">

          {view === "ticket" ? (
            /* ------------------- TICKET VIEW ------------------- */
            <div className="bg-white mt-0">

              <div className="bg-blue-500 text-white px-4 py-4 flex items-center justify-between">
                <ChevronLeft className="w-7 h-7" />
                <h1 className="text-base font-medium">One Way Ticket</h1>
                <button onClick={() => setView("customize")}>
                  <Settings className="w-6 h-6" />
                </button>
              </div>

              <div className="p-4">

                {/* QR BOX */}
                <div className="bg-white rounded-2xl shadow-xl p-6 text-center">

                  <div className="flex justify-center mb-2">
                    <div className="w-40 h-40 rounded-2xl flex items-center justify-center"
                      style={{ background:colors.qrBackground }}>
                      {qrCodeImage ? (
                        <img src={qrCodeImage} className="w-32 h-32" />
                      ) : (
                        <div className="text-xs">QR Placeholder</div>
                      )}
                    </div>
                  </div>

                  <p className="text-gray-500 text-[10px]">Tap to enlarge</p>

                  <div className="border-t-2 border-dashed my-4"></div>

                  <h2 className="text-2xl font-bold" style={{color:colors.zoneNameColor}}>
                    {zoneName}
                  </h2>

                  <div className="font-extrabold"
                    style={{ fontSize: zoneNumberSize+"px", lineHeight:"0.8" }}>
                    {zoneNumber}
                  </div>

                  <p className="text-lg font-semibold">ZONE RIDE</p>
                  <p className="font-semibold">{passengerCount} {passengerType}</p>

                  <div className="mt-10"></div>

                  {/* PROGRESS BAR */}
                  <div className="w-full h-4 mb-4 overflow-hidden">
                    {showProgress && (
                      <div className="h-full w-full"
                        style={{
                          background:`linear-gradient(to right,
                            ${colors.progressColors[0]} 0%,
                            ${colors.progressColors[0]} 30%,
                            ${colors.progressColors[1]} 30%,
                            ${colors.progressColors[1]} 65%,
                            ${colors.progressColors[2]} 65%,
                            ${colors.progressColors[2]} 100%)`
                        }}
                      />
                    )}
                  </div>

                  <div className="border-t my-3"></div>

                  <p className="font-bold text-xl">
                    Expires in {formatTime(timeRemaining)}
                  </p>

                  <p className="underline text-[11px] mt-2">View Onboard Validator Instructions</p>

                </div>

              </div>
            </div>

          ) : (
            /* ------------------- CUSTOMIZE VIEW ------------------- */
            <div className="bg-blue-500 p-4 min-h-screen">
              <div className="bg-white rounded-2xl p-6">

                <div className="flex justify-between mb-4">
                  <button onClick={()=>setView("ticket")}>
                    <ChevronLeft className="w-6 h-6" />
                  </button>
                  <h2 className="font-bold text-xl">Customize</h2>
                  <div className="w-6"></div>
                </div>

                {/* MANY FIELDS */}
                <div className="space-y-4">

                  <button
                    onClick={toggleInterstateMode}
                    className={"w-full py-4 rounded-xl font-semibold text-white " +
                      (isInterstateMode ? "bg-red-600" : "bg-black")}
                  >
                    {isInterstateMode
                      ? "ðŸ”´ INTERSTATE (60 min)"
                      : "âš« INTRASTATE (30 min)"}
                  </button>

                  <input type="range" min="80" max="130" value={zoneNumberSize}
                    onChange={(e)=>setZoneNumberSize(e.target.value)} className="w-full" />

                  <button className="border-2 border-dashed w-full p-4 rounded-xl bg-purple-50"
                    onClick={()=>qrInputRef.current.click()}>
                    Upload QR
                  </button>
                  <input type="file" accept="image/*" ref={qrInputRef}
                    onChange={handleQrUpload} className="hidden" />

                  <button className="border-2 border-dashed w-full p-4 rounded-xl"
                    onClick={()=>fileInputRef.current.click()}>
                    Upload Screenshot (Colors)
                  </button>
                  <input type="file" accept="image/*" ref={fileInputRef}
                    onChange={handleImageUpload} className="hidden" />

                  <input type="number" value={zoneNumber}
                    onChange={e=>setZoneNumber(e.target.value)} className="w-full border p-3 rounded-xl" />

                  <input type="text" value={zoneName}
                    onChange={e=>setZoneName(e.target.value.toUpperCase())}
                    className="w-full border p-3 rounded-xl uppercase" />

                  <input type="color" value={colors.zoneNameColor}
                    onChange={e=>setColors({...colors, zoneNameColor:e.target.value})}
                    className="w-full h-12 rounded-xl" />

                  <input type="color" value={colors.qrBackground}
                    onChange={e=>setColors({...colors, qrBackground:e.target.value})}
                    className="w-full h-12 rounded-xl" />

                  <button
                    onClick={()=>setView("ticket")}
                    className="w-full bg-blue-600 py-4 rounded-xl text-white font-semibold">
                    Apply
                  </button>

                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    /* -------------- FIXED: ReactDOM.render() (work in Babel) -------------- */
    ReactDOM.render(<TicketDemo />, document.getElementById("root"));

  </script>
</body>
</html>
