<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Ticket Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transform -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-black">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      const TicketDemo = () => {
        const [view, setView] = useState('ticket');
        const [zoneNumber, setZoneNumber] = useState(2);
        const [zoneName, setZoneName] = useState('INTRASTATE');
        const [passengerCount, setPassengerCount] = useState(1);
        const [passengerType, setPassengerType] = useState('Adult');
        const [validityMinutes, setValidityMinutes] = useState(30);

        const [colors, setColors] = useState({
          qrBackground: '#d8b4fe',
          progressColors: ['#7c3aed', '#ec4899', '#22c55e']
        });

        const [timeRemaining, setTimeRemaining] = useState(validityMinutes * 60);
        const [isActive, setIsActive] = useState(true);
        const [qrCodeImage, setQrCodeImage] = useState(null);
        const [blinkSpeed, setBlinkSpeed] = useState(500); // milliseconds
        const [showProgress, setShowProgress] = useState(true);
        const [qrPattern] = useState(() => {
          // Generate a more realistic QR code pattern (similar to the screenshot)
          const pattern = Array(29).fill(null).map(() => Array(29).fill(false));

          // Add corner position markers (large squares)
          const addCornerMarker = (startX, startY) => {
            // Outer square
            for (let i = 0; i < 7; i++) {
              for (let j = 0; j < 7; j++) {
                if (i === 0 || i === 6 || j === 0 || j === 6) {
                  pattern[startX + i][startY + j] = true;
                }
              }
            }
            // Inner square
            for (let i = 2; i < 5; i++) {
              for (let j = 2; j < 5; j++) {
                pattern[startX + i][startY + j] = true;
              }
            }
          };

          // Add the three corner markers
          addCornerMarker(0, 0); // Top-left
          addCornerMarker(0, 22); // Top-right
          addCornerMarker(22, 0); // Bottom-left

          // Fill middle area with random data pattern
          for (let i = 8; i < 22; i++) {
            for (let j = 8; j < 22; j++) {
              pattern[i][j] = Math.random() > 0.5;
            }
          }

          // Add some random data in edges
          for (let i = 8; i < 29; i++) {
            for (let j = 0; j < 8; j++) {
              if (Math.random() > 0.6) pattern[i][j] = true;
            }
          }

          for (let i = 0; i < 8; i++) {
            for (let j = 8; j < 29; j++) {
              if (Math.random() > 0.6) pattern[i][j] = true;
            }
          }

          return pattern;
        });

        const fileInputRef = useRef(null);
        const qrInputRef = useRef(null);

        useEffect(() => {
          if (!isActive || timeRemaining <= 0) return;

          const interval = setInterval(() => {
            setTimeRemaining(prev => {
              if (prev <= 1) {
                setIsActive(false);
                return 0;
              }
              return prev - 1;
            });
          }, 1000);

          return () => clearInterval(interval);
        }, [isActive, timeRemaining]);

        // Blinking effect for progress bar
        useEffect(() => {
          const blinkInterval = setInterval(() => {
            setShowProgress(prev => !prev);
          }, blinkSpeed);

          return () => clearInterval(blinkInterval);
        }, [blinkSpeed]);

        const formatTime = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        const progressPercentage = (timeRemaining / (validityMinutes * 60)) * 100;

        const handleImageUpload = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = img.width;
              canvas.height = img.height;
              ctx.drawImage(img, 0, 0);

              const samples = [
                ctx.getImageData(img.width * 0.3, img.height * 0.3, 1, 1).data,
                ctx.getImageData(img.width * 0.5, img.height * 0.5, 1, 1).data,
                ctx.getImageData(img.width * 0.7, img.height * 0.7, 1, 1).data,
              ];

              const rgbToHex = (r, g, b) => {
                return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
              };

              setColors({
                qrBackground: rgbToHex(samples[0][0], samples[0][1], samples[0][2]),
                progressColors: [
                  rgbToHex(samples[0][0], samples[0][1], samples[0][2]),
                  rgbToHex(samples[1][0], samples[1][1], samples[1][2]),
                  rgbToHex(samples[2][0], samples[2][1], samples[2][2])
                ]
              });
            };
            img.src = event.target.result;
          };
          reader.readAsDataURL(file);
        };

        const handleQrUpload = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (event) => {
            setQrCodeImage(event.target.result);
          };
          reader.readAsDataURL(file);
        };

        const resetTimer = () => {
          setTimeRemaining(validityMinutes * 60);
          setIsActive(true);
        };

        return (
          <div className="min-h-screen flex flex-col">
            {view === 'ticket' ? (
              <>
                <div className="bg-blue-500">
                  <div className="flex items-center justify-between px-4 py-4 text-white">
                    <button className="p-1" onClick={() => {}}>
                      {/* Simple left arrow instead of lucide icon */}
                      <span className="text-2xl font-bold">&lt;</span>
                    </button>
                    <h1 className="text-lg font-medium">One Way Ticket</h1>
                    <button onClick={() => setView('customize')} className="p-1">
                      {/* Simple gear emoji instead of lucide icon */}
                      <span className="text-2xl">‚öôÔ∏è</span>
                    </button>
                  </div>
                </div>

                <div
                  className="flex-1 relative"
                  style={{ background: 'linear-gradient(to bottom, #3b82f6 0%, #3b82f6 35%, white 35%, white 100%)' }}
                >
                  <div className="px-4 pt-4">
                    <div className="w-full max-w-lg mx-auto bg-white rounded-3xl shadow-2xl">
                      <div className="pt-8 pb-4 px-6 flex flex-col items-center">
                        <div
                          className="w-56 h-56 rounded-3xl flex items-center justify-center mb-2"
                          style={{ backgroundColor: colors.qrBackground }}
                        >
                          {qrCodeImage ? (
                            <img
                              src={qrCodeImage}
                              alt="QR Code"
                              className="w-48 h-48 object-contain"
                            />
                          ) : (
                            <svg className="w-48 h-48" viewBox="0 0 29 29">
                              <rect x="0" y="0" width="29" height="29" fill="white" />
                              {qrPattern.map((row, i) =>
                                row.map((isBlack, j) =>
                                  isBlack && (
                                    <rect
                                      key={`${i}-${j}`}
                                      x={j}
                                      y={i}
                                      width="0.95"
                                      height="0.95"
                                      fill="black"
                                    />
                                  )
                                )
                              )}
                            </svg>
                          )}
                        </div>
                        <p className="text-gray-500 text-sm">Tap to enlarge</p>
                      </div>

                      <div className="px-6 py-2">
                        <div className="border-t-2 border-dashed border-gray-300"></div>
                      </div>

                      <div className="px-6 pb-8 pt-4 text-center">
                        <h2
                          className="font-bold tracking-normal mb-1"
                          style={{
                            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                            fontWeight: 700,
                            fontSize: '36px',
                          }}
                        >
                          {zoneName}
                        </h2>
                        <div
                          className="font-black leading-none my-3"
                          style={{
                            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                            fontSize: '90px',
                          }}
                        >
                          {zoneNumber}
                        </div>
                        <p
                          className="font-bold mb-1"
                          style={{
                            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                            fontSize: '20px',
                          }}
                        >
                          ZONE RIDE
                        </p>
                        <p
                          className="font-semibold mb-20"
                          style={{
                            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                            fontSize: '18px',
                          }}
                        >
                          {passengerCount} {passengerType}
                        </p>

                        <div className="w-full mb-2">
                          <div className="flex h-3 overflow-hidden bg-white">
                            {showProgress && (
                              <div
                                className="transition-all duration-300"
                                style={{
                                  width: `${progressPercentage}%`,
                                  background: `linear-gradient(to right, ${colors.progressColors[0]} 0%, ${colors.progressColors[0]} 30%, ${colors.progressColors[1]} 30%, ${colors.progressColors[1]} 65%, ${colors.progressColors[2]} 65%, ${colors.progressColors[2]} 100%)`,
                                }}
                              />
                            )}
                          </div>
                        </div>

                        <div className="w-full h-px bg-gray-300 my-6"></div>

                        <div className="mb-6">
                          <p
                            className="font-bold"
                            style={{
                              fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                              fontSize: '24px',
                            }}
                          >
                            Expires in {formatTime(timeRemaining)}
                          </p>
                        </div>

                        <a
                          href="#"
                          className="underline text-gray-900"
                          style={{
                            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
                            fontSize: '13px',
                          }}
                        >
                          View Onboard Validator Instructions
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </>
            ) : (
              <div className="flex-1 p-4 overflow-auto bg-blue-500">
                <div className="max-w-md mx-auto bg-white rounded-2xl p-6 shadow-xl">
                  <div className="flex items-center justify-between mb-6">
                    <button onClick={() => setView('ticket')}>
                      <span className="text-2xl font-bold">&lt;</span>
                    </button>
                    <h2 className="text-xl font-bold">Customize</h2>
                    <div className="w-6"></div>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-semibold mb-2">Upload Your QR Code</label>
                      <input
                        ref={qrInputRef}
                        type="file"
                        accept="image/*"
                        onChange={handleQrUpload}
                        className="hidden"
                      />
                      <button
                        onClick={() => qrInputRef.current && qrInputRef.current.click()}
                        className="w-full border-2 border-dashed rounded-xl p-4 hover:border-purple-500 bg-purple-50"
                      >
                        {qrCodeImage ? '‚úÖ QR Code Set' : 'üì∑ Upload QR Code from Screenshot'}
                      </button>
                      <p className="text-xs text-gray-500 mt-1">Upload once and it stays permanent</p>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">
                        Upload Image for Colors (Optional)
                      </label>
                      <input
                        ref={fileInputRef}
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        className="hidden"
                      />
                      <button
                        onClick={() => fileInputRef.current && fileInputRef.current.click()}
                        className="w-full border-2 border-dashed rounded-xl p-4 hover:border-blue-500"
                      >
                        üì∏ Upload Screenshot
                      </button>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">Zone Number</label>
                      <input
                        type="number"
                        value={zoneNumber}
                        onChange={(e) => setZoneNumber(parseInt(e.target.value) || 1)}
                        className="w-full px-4 py-3 border rounded-xl text-center text-2xl font-bold"
                        min="1"
                        max="10"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">Zone Name</label>
                      <input
                        type="text"
                        value={zoneName}
                        onChange={(e) => setZoneName(e.target.value.toUpperCase())}
                        className="w-full px-4 py-3 border rounded-xl uppercase"
                      />
                    </div>

                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Passengers</label>
                        <input
                          type="number"
                          value={passengerCount}
                          onChange={(e) => setPassengerCount(parseInt(e.target.value) || 1)}
                          className="w-full px-4 py-3 border rounded-xl"
                          min="1"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-2">Type</label>
                        <select
                          value={passengerType}
                          onChange={(e) => setPassengerType(e.target.value)}
                          className="w-full px-4 py-3 border rounded-xl"
                        >
                          <option>Adult</option>
                          <option>Child</option>
                          <option>Senior</option>
                          <option>Student</option>
                        </select>
                      </div>
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">Duration (minutes)</label>
                      <input
                        type="number"
                        value={validityMinutes}
                        onChange={(e) => {
                          const mins = parseInt(e.target.value) || 30;
                          setValidityMinutes(mins);
                          setTimeRemaining(mins * 60);
                        }}
                        className="w-full px-4 py-3 border rounded-xl"
                        min="1"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">QR Background</label>
                      <input
                        type="color"
                        value={colors.qrBackground}
                        onChange={(e) => setColors({ ...colors, qrBackground: e.target.value })}
                        className="w-full h-12 rounded-xl cursor-pointer"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold mb-2">Progress Bar Colors</label>
                      <div className="grid grid-cols-3 gap-2">
                        {colors.progressColors.map((color, idx) => (
                          <input
                            key={idx}
                            type="color"
                            value={color}
                            onChange={(e) => {
                              const newColors = [...colors.progressColors];
                              newColors[idx] = e.target.value;
                              setColors({ ...colors, progressColors: newColors });
                            }}
                            className="w-full h-12 rounded-xl cursor-pointer"
                          />
                        ))}
                      </div>
                    </div>

                    <div className="border-t-2 border-gray-200 pt-4 mt-4">
                      <h3 className="font-bold text-gray-800 mb-3">Progress Bar Animation</h3>
                      <div>
                        <label className="block text-sm font-semibold mb-2">
                          Blink Speed: {blinkSpeed}ms (blinks {Math.round(1000 / blinkSpeed)} times/second)
                        </label>
                        <input
                          type="range"
                          min="100"
                          max="2000"
                          step="100"
                          value={blinkSpeed}
                          onChange={(e) => setBlinkSpeed(parseInt(e.target.value))}
                          className="w-full"
                        />
                        <div className="flex justify-between text-xs text-gray-500 mt-1">
                          <span>Fast (100ms)</span>
                          <span>Slow (2000ms)</span>
                        </div>
                      </div>
                    </div>

                    <div className="border-t-2 border-gray-200 pt-4 mt-4">
                      <h3 className="font-bold text-gray-800 mb-3">Timer Controls</h3>
                      <div className="flex gap-2">
                        <button
                          onClick={resetTimer}
                          className="flex-1 bg-green-500 text-white py-3 rounded-xl font-semibold"
                        >
                          üîÑ Reset Timer
                        </button>
                        <button
                          onClick={() => setIsActive(!isActive)}
                          className="flex-1 bg-orange-500 text-white py-3 rounded-xl font-semibold"
                        >
                          {isActive ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Resume'}
                        </button>
                      </div>
                    </div>

                    <button
                      onClick={() => setView('ticket')}
                      className="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold mt-4"
                    >
                      Apply Changes
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<TicketDemo />);
    </script>
  </body>
</html>
